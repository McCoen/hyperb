source("damping/hyperb.m");
source("damping/grid_integration.m");
source("minimization/pen_minimization.m");
source("minimization/marquardt.m");
source("minimization/mq_hessian.m");
source("minimization/mq_grad.m");

global boundary = @(x) 0.5 * x * (1 - x);

global task = 5;

global a = 1;
global l = 1;
global t_total = 0.05;

global vareps = power(10, -12);

global num_of_dampers = 1;
global damper_x = [0.5];
global wt_bounds = [nan, nan];

global enable_interpolation = false;
global full_diff = true;

global n = 16;
global k = 8;
global hx = l / n;
global ht = t_total / k;
global wt = zeros(k + 1, num_of_dampers);

global alpha = osc_alpha();
global beta = osc_beta();

global b = osc_b();
global c = osc_c();
global c_inverted = inv(c);
global sweep_side = eye(2);
global cTilde = osc_cTilde();

global y = osc_y();
global y_sec = osc_sec_y();

global xr = 0.0 : hx : l;
global yr = 0.0 : ht : t_total;

global eta = power(10, -3);
global xi = power(10, -4);

print_task_init();

%  plot_start_h();
%  exit;

wt = [9.1841751112359915509841812308877706527709960937500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
-8.8056999653002677064250747207552194595336914062500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
5.1527390779558331246335001196712255477905273437500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
-1.5983501434934467511084221769124269485473632812500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
-1.4192003767252920454211562173441052436828613281250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
6.8157449879532464365183841437101364135742187500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
-8.9385146839443848421069560572504997253417968750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+01;
1.8295414265173457124546985141932964324951171875000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+02;
-2.2419345898678233197642839513719081878662109375000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e+02];

%wt = marquardt_continue(@solve_all, damper_x, 'marquardt_last', 10, vareps);
%wt = marquardt(@solve_all, damper_x, wt, 10, vareps, power(10, 4));

print_dampers_info();
disp('E(T) = ');
err = solve_all(wt);
disp(err);
disp('');

print_u_grid_values();

%  plot_u_grid(err);
#plot_f(1, damper_x, wt);
plot_wt(wt, 1);
